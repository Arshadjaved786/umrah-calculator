{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Taj Tech\\\\Downloads\\\\umrah-calculator\\\\src\\\\pages\\\\TripPlanner.jsx\",\n  _s = $RefreshSig$();\n// src/pages/TripPlanner.jsx\nimport React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { generateItinerary } from \"../utils/dateHelpers\";\nimport TripSummaryCard from \"../components/TripPlanner/TripSummaryCard\";\nimport { adjustStaysManually } from \"../utils/manualAdjuster\";\n\n/**\r\n * TripPlanner page (UI)\r\n * - Supports exclude first/last night and shows counted dates in calendar (display).\r\n * - Shows notes about original dates when excluded.\r\n * - Mark weekend nights (Thu + Fri) based on counted nights.\r\n * - Removes Jeddah option from city dropdown.\r\n *\r\n * Important:\r\n * - generateItinerary remains core calculation.\r\n * - This UI builds adjustedResult from core result and toggles, and updates displayed dates.\r\n */\n\n/* Safe ISO helpers: avoid timezone shifts by splitting */\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction isoToDate(iso) {\n  if (!iso) return null;\n  const parts = String(iso).split(\"-\");\n  const yyyy = Number(parts[0]);\n  const mm = Number(parts[1]) - 1;\n  const dd = Number(parts[2]);\n  return new Date(yyyy, mm, dd);\n}\nfunction dateToIso(d) {\n  if (!d) return \"\";\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\nfunction addDaysIso(iso, n) {\n  const dt = isoToDate(iso);\n  if (!dt) return iso;\n  const d = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate());\n  d.setDate(d.getDate() + n);\n  return dateToIso(d);\n}\n/**\r\n * ðŸ” Recalculate preview stays dates\r\n * based on MANUAL counted days\r\n *\r\n * Live preview ONLY â€” final commit on Accept\r\n */\nfunction rebuildPreviewFromManual(adjustedResult, manualStays) {\n  var _manualStays$, _next$adjustedStays$;\n  if (!adjustedResult || !manualStays) return adjustedResult;\n  const next = JSON.parse(JSON.stringify(adjustedResult));\n  let cursor = ((_manualStays$ = manualStays[0]) === null || _manualStays$ === void 0 ? void 0 : _manualStays$.isoCheckIn) || ((_next$adjustedStays$ = next.adjustedStays[0]) === null || _next$adjustedStays$ === void 0 ? void 0 : _next$adjustedStays$.countedCheckInIso);\n  next.adjustedStays.forEach((s, i) => {\n    const m = manualStays[i];\n    const nights = m.displayDays;\n    s.countedDays = nights;\n    s.countedCheckInIso = cursor;\n    const lastNight = addDaysIso(cursor, nights - 1);\n    s.countedLastNightIso = lastNight;\n    cursor = addDaysIso(lastNight, 1);\n  });\n  return next;\n}\n\n/**\r\n * ðŸ” Build adjustedSegments from adjustedStays\r\n * So UI dates (check-in / check-out / travel)\r\n * update immediately on manual + / âˆ’\r\n */\nfunction rebuildSegmentsFromStays(adjustedResult) {\n  if (!adjustedResult || !adjustedResult.adjustedStays) return adjustedResult;\n  const next = JSON.parse(JSON.stringify(adjustedResult));\n  const segments = [];\n  next.adjustedStays.forEach((s, i) => {\n    // stay segment (FULL SHAPE)\n    segments.push({\n      type: \"stay\",\n      city: s.city,\n      originalDays: s.originalDays,\n      countedDays: s.countedDays,\n      // calendar dates (original)\n      checkIn: s.checkIn,\n      checkOut: s.checkOut,\n      isoCheckIn: s.isoCheckIn,\n      isoCheckOut: s.isoCheckOut,\n      isoLastNight: s.isoLastNight,\n      // counted dates (manual/exclude aware)\n      countedCheckInIso: s.countedCheckInIso,\n      countedLastNightIso: s.countedLastNightIso,\n      countedNights: s.countedNights || [],\n      weekendDates: s.weekendDates || []\n    });\n\n    // travel segment\n    if (i < next.adjustedStays.length - 1) {\n      const travelIso = addDaysIso(s.countedLastNightIso, 1);\n      segments.push({\n        type: \"travel\",\n        iso: travelIso,\n        date: {\n          iso: travelIso,\n          human: travelIso ? (() => {\n            const d = isoToDate(travelIso);\n            const days = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n            const mon = d.toLocaleString(\"en-US\", {\n              month: \"short\"\n            });\n            return `${String(d.getDate()).padStart(2, \"0\")} ${mon} (${days[d.getDay()]})`;\n          })() : \"â€”\"\n        }\n      });\n    }\n  });\n  next.adjustedSegments = segments;\n  return next;\n}\n\n/**\r\n * Build adjusted result for UI:\r\n * - applies excludeArrival/excludeExit\r\n * - computes countedCheckInIso / countedLastNightIso per stay\r\n * - computes weekendDates per stay (Thu+Fri) based on counted nights\r\n */\nfunction buildAdjustedResult(result, excludeArrival, excludeExit, markWeekend) {\n  if (!result) return null;\n  const segs = JSON.parse(JSON.stringify(result.segments || []));\n\n  // stays only\n  const stays = segs.filter(s => s.type === \"stay\");\n\n  // create adjusted stays\n  const adjustedStays = stays.map((s, idx) => {\n    var _s$checkIn, _s$displayDays, _ref, _s$displayDays2, _s$displayDays3;\n    const isoCheckIn = s.isoCheckIn || ((_s$checkIn = s.checkIn) === null || _s$checkIn === void 0 ? void 0 : _s$checkIn.iso);\n    const isoLastNight = s.lastNight && (s.lastNight.iso || s.lastNight) || addDaysIso(isoCheckIn, ((_s$displayDays = s.displayDays) !== null && _s$displayDays !== void 0 ? _s$displayDays : s.days) - 1);\n    let countedDays = Number((_ref = (_s$displayDays2 = s.displayDays) !== null && _s$displayDays2 !== void 0 ? _s$displayDays2 : s.days) !== null && _ref !== void 0 ? _ref : 0);\n    if (excludeArrival && idx === 0) {\n      countedDays = Math.max(0, countedDays - 1);\n    }\n    if (excludeExit && idx === stays.length - 1) {\n      countedDays = Math.max(0, countedDays - 1);\n    }\n    const countedCheckInIso = excludeArrival && idx === 0 ? addDaysIso(isoCheckIn, 1) : isoCheckIn;\n    const countedLastNightIso = (() => {\n      if (excludeExit && idx === stays.length - 1) {\n        // if exclude last night, move lastNight back one day\n        return addDaysIso(isoLastNight, -1);\n      }\n      // otherwise count from countedCheckInIso + (countedDays - 1)\n      return addDaysIso(countedCheckInIso, Math.max(0, countedDays - 1));\n    })();\n\n    // build counted nights array for this stay (every counted night iso)\n    const countedNights = [];\n    if (countedDays > 0) {\n      let cur = isoToDate(countedCheckInIso);\n      const last = isoToDate(countedLastNightIso);\n      while (cur && last && cur <= last) {\n        countedNights.push(dateToIso(cur));\n        cur.setDate(cur.getDate() + 1);\n      }\n    }\n\n    // weekend detection (Thu=4, Fri=5)\n    const weekendDates = [];\n    if (markWeekend && countedNights.length > 0) {\n      countedNights.forEach(iso => {\n        const d = isoToDate(iso);\n        const day = d.getDay();\n        if (day === 4 || day === 5) weekendDates.push(iso);\n      });\n    }\n    return {\n      ...s,\n      countedDays,\n      countedCheckInIso,\n      countedLastNightIso,\n      countedNights,\n      weekendDates,\n      originalDays: (_s$displayDays3 = s.displayDays) !== null && _s$displayDays3 !== void 0 ? _s$displayDays3 : s.days\n    };\n  });\n\n  // build adjusted segments (stay + travel) for display\n  const adjustedSegments = [];\n  for (let i = 0; i < adjustedStays.length; i++) {\n    const s = adjustedStays[i];\n    adjustedSegments.push({\n      type: \"stay\",\n      city: s.city,\n      originalDays: s.originalDays,\n      countedDays: s.countedDays,\n      checkIn: s.checkIn,\n      // original formatted\n      checkOut: s.checkOut,\n      // original formatted (we keep)\n      isoCheckIn: s.isoCheckIn,\n      isoCheckOut: s.isoCheckOut,\n      countedCheckInIso: s.countedCheckInIso,\n      countedLastNightIso: s.countedLastNightIso,\n      countedNights: s.countedNights,\n      weekendDates: s.weekendDates\n    });\n    if (i < adjustedStays.length - 1) {\n      var _s$checkOut;\n      // find corresponding travel seg (fallback to s.checkOut)\n      adjustedSegments.push({\n        type: \"travel\",\n        date: s.checkOut,\n        iso: s.isoCheckOut || ((_s$checkOut = s.checkOut) === null || _s$checkOut === void 0 ? void 0 : _s$checkOut.iso)\n      });\n    }\n  }\n\n  // compute per-city totals (based on countedNights)\n  let makkahNights = 0,\n    madinahNights = 0,\n    countedTotal = 0;\n  adjustedStays.forEach(s => {\n    var _s$countedDays;\n    const d = (_s$countedDays = s.countedDays) !== null && _s$countedDays !== void 0 ? _s$countedDays : 0;\n    countedTotal += d;\n    if (s.city === \"makkah\") makkahNights += d;\n    if (s.city === \"madinah\") madinahNights += d;\n  });\n  return {\n    ...result,\n    adjustedSegments,\n    adjustedStays,\n    countedTotal,\n    makkahNights,\n    madinahNights\n  };\n}\nexport default function TripPlanner() {\n  _s();\n  const now = new Date();\n  const localToday = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, \"0\")}-${String(now.getDate()).padStart(2, \"0\")}`;\n\n  // original values (what user inputs)\n  const [originalDeparture, setOriginalDeparture] = useState(localToday);\n  const [originalExitDate, setOriginalExitDate] = useState(\"\");\n\n  // displayed calendar values (may be adjusted when excludes used)\n  const [displayDeparture, setDisplayDeparture] = useState(localToday);\n  const [displayExit, setDisplayExit] = useState(\"\");\n  const [totalDays, setTotalDays] = useState(15);\n  const [useCustomTotal, setUseCustomTotal] = useState(false);\n  const [customTotal, setCustomTotal] = useState(15);\n  const [useExitDate, setUseExitDate] = useState(false);\n  const [exitDateInput, setExitDateInput] = useState(\"\");\n  const [startCity, setStartCity] = useState(\"makkah\");\n  const [exitCity, setExitCity] = useState(\"makkah\");\n  const [maxMadinah, setMaxMadinah] = useState(false);\n\n  // NEW UI flags:\n  const [excludeArrival, setExcludeArrival] = useState(false);\n  const [excludeExit, setExcludeExit] = useState(false);\n  const [markWeekend, setMarkWeekend] = useState(false); // Thu+Fri\n\n  const [result, setResult] = useState(null);\n  const [adjustedResult, setAdjustedResult] = useState(null);\n  const [note, setNote] = useState(\"\");\n  // Manual adjustment state\n  const [manualStays, setManualStays] = useState(null);\n  const [manualFridayWarning, setManualFridayWarning] = useState(false);\n  const [theme, setTheme] = useState(\"bg-teal-600\");\n  const navigate = useNavigate();\n\n  // normalize helpers: ensure passing YYYY-MM-DD to core\n  function toLocalIso(val) {\n    if (!val) return val;\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(val)) return val;\n    const d = new Date(val);\n    if (isNaN(d.getTime())) return val;\n    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(d.getDate()).padStart(2, \"0\")}`;\n  }\n\n  // When user changes the departure input, keep original and display in sync\n  function onDepartureChange(v) {\n    setOriginalDeparture(v);\n    setDisplayDeparture(v);\n  }\n  function onExitChange(v) {\n    setOriginalExitDate(v);\n    setDisplayExit(v);\n    setExitDateInput(v);\n  }\n\n  // Create itinerary\n  function onGenerate(e) {\n    var _e$preventDefault, _coreLastStay$checkOu;\n    e === null || e === void 0 ? void 0 : (_e$preventDefault = e.preventDefault) === null || _e$preventDefault === void 0 ? void 0 : _e$preventDefault.call(e);\n    setNote(\"\");\n    const opts = {\n      departureDate: toLocalIso(originalDeparture),\n      startCity,\n      exitCity,\n      maxMadinah\n    };\n    if (useExitDate && exitDateInput) {\n      opts.exitDate = toLocalIso(exitDateInput);\n    } else if (useCustomTotal) {\n      opts.totalDays = Number(customTotal);\n    } else {\n      opts.totalDays = Number(totalDays);\n    }\n    const res = generateItinerary(opts);\n    if (res.error) {\n      setNote(res.error);\n      setResult(null);\n      setAdjustedResult(null);\n      return;\n    }\n    setResult(res);\n\n    // build adjusted result based on UI flags\n    const adj = buildAdjustedResult(res, excludeArrival, excludeExit, markWeekend);\n    setAdjustedResult(adj);\n    // initialize manual stays from adjusted stays\n    if (adj !== null && adj !== void 0 && adj.adjustedStays) {\n      setManualStays(adj.adjustedStays.map(s => {\n        var _ref2, _s$originalDays;\n        return {\n          city: s.city,\n          // âœ… IMPORTANT:\n          // Manual system ab COUNTED nights se start karega\n          displayDays: typeof s.countedDays === \"number\" ? s.countedDays : (_ref2 = (_s$originalDays = s.originalDays) !== null && _s$originalDays !== void 0 ? _s$originalDays : s.displayDays) !== null && _ref2 !== void 0 ? _ref2 : s.days,\n          isoCheckIn: s.countedCheckInIso || s.isoCheckIn,\n          locked: false\n        };\n      }));\n      setManualFridayWarning(false);\n    }\n\n    // Update displayed calendar values depending on exclude flags:\n    // Display departure as countedCheckIn of first stay if excludeArrival, else originalDeparture (or core departure iso)\n    const firstStay = adj && adj.adjustedStays && adj.adjustedStays[0] || null;\n    if (firstStay) {\n      if (excludeArrival) {\n        setDisplayDeparture(firstStay.countedCheckInIso || firstStay.isoCheckIn || originalDeparture);\n      } else {\n        // Use originalDeparture (user-chosen) or normalized core departure\n        setDisplayDeparture(toLocalIso(originalDeparture));\n      }\n    }\n\n    // Compute original exit iso from core result (last stay lastNight)\n    const coreLastStay = res.segments ? res.segments.filter(s => s.type === \"stay\").slice(-1)[0] : null;\n\n    // UPDATED: prefer last night as exit date for form\n    const coreExitIso = coreLastStay ? coreLastStay.isoLastNight || coreLastStay.isoCheckOutDay || ((_coreLastStay$checkOu = coreLastStay.checkOut) === null || _coreLastStay$checkOu === void 0 ? void 0 : _coreLastStay$checkOu.iso) || \"\" : \"\";\n\n    // For displayExit: if excludeExit true -> show countedLastNight of last adjusted stay\n    const lastAdjStay = adj && adj.adjustedStays && adj.adjustedStays.slice(-1)[0] || null;\n    if (lastAdjStay) {\n      if (excludeExit) {\n        setDisplayExit(lastAdjStay.countedLastNightIso || lastAdjStay.isoCheckOut || coreExitIso);\n      } else {\n        // show original exit (from core)\n        setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\n      }\n    } else {\n      setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\n    }\n    setNote(\"Itinerary generated successfully.\");\n  }\n\n  // recompute adjusted result and update display when toggles change\n  useEffect(() => {\n    var _coreLastStay$checkOu2;\n    if (!result) return;\n    const adj = buildAdjustedResult(result, excludeArrival, excludeExit, markWeekend);\n    setAdjustedResult(adj);\n\n    // update display departure/exit based on current toggles\n    const firstStay = adj && adj.adjustedStays && adj.adjustedStays[0] || null;\n    if (firstStay) {\n      if (excludeArrival) setDisplayDeparture(firstStay.countedCheckInIso || firstStay.isoCheckIn);else setDisplayDeparture(toLocalIso(originalDeparture));\n    }\n    const lastAdjStay = adj && adj.adjustedStays && adj.adjustedStays.slice(-1)[0] || null;\n    const coreLastStay = result.segments ? result.segments.filter(s => s.type === \"stay\").slice(-1)[0] : null;\n\n    // UPDATED: prefer last night as exit date for form\n    const coreExitIso = coreLastStay ? coreLastStay.isoLastNight || coreLastStay.isoCheckOutDay || ((_coreLastStay$checkOu2 = coreLastStay.checkOut) === null || _coreLastStay$checkOu2 === void 0 ? void 0 : _coreLastStay$checkOu2.iso) || \"\" : \"\";\n    if (lastAdjStay) {\n      if (excludeExit) setDisplayExit(lastAdjStay.countedLastNightIso || lastAdjStay.isoCheckOut || coreExitIso);else setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\n    } else {\n      setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\n    }\n    // recompute note cleared/updated\n  }, [excludeArrival, excludeExit, markWeekend, result]); // eslint-disable-line\n\n  function onManualAdjust(stayIndex, delta) {\n    var _newAdjusted$adjusted;\n    if (!manualStays || !adjustedResult) return;\n    const {\n      stays,\n      fridayWarning,\n      balanceWarning\n    } = adjustStaysManually(manualStays, stayIndex, delta);\n    setManualStays(stays);\n    setManualFridayWarning(fridayWarning);\n    if (balanceWarning) return;\n\n    // -------------------------------\n    // ðŸ” Rebuild adjustedResult dates\n    // based on MANUAL counted days\n    // -------------------------------\n    const newAdjusted = JSON.parse(JSON.stringify(adjustedResult));\n    let cursor = stays[0].isoCheckIn || ((_newAdjusted$adjusted = newAdjusted.adjustedStays[0]) === null || _newAdjusted$adjusted === void 0 ? void 0 : _newAdjusted$adjusted.countedCheckInIso);\n    newAdjusted.adjustedStays.forEach((s, i) => {\n      const manual = stays[i];\n      const nights = manual.displayDays;\n      s.countedDays = nights;\n      s.countedCheckInIso = cursor;\n\n      // last night = checkin + (nights - 1)\n      const lastNight = addDaysIso(cursor, nights - 1);\n      s.countedLastNightIso = lastNight;\n\n      // âœ… weekend nights ONLY if feature is ON\n      let weekendDates = [];\n      if (markWeekend) {\n        let d = isoToDate(s.countedCheckInIso);\n        const end = isoToDate(s.countedLastNightIso);\n        while (d && end && d <= end) {\n          const day = d.getDay(); // Thu=4, Fri=5\n          if (day === 4 || day === 5) {\n            weekendDates.push(dateToIso(d));\n          }\n          d.setDate(d.getDate() + 1);\n        }\n      }\n      s.weekendDates = weekendDates;\n\n      // next checkin = last night + 1\n      cursor = addDaysIso(lastNight, 1);\n    });\n\n    // ðŸ” Live preview: rebuild stays + segments\n    const previewStays = rebuildPreviewFromManual(newAdjusted, stays);\n    const previewFinal = rebuildSegmentsFromStays(previewStays);\n    setAdjustedResult(previewFinal);\n  }\n\n  // Accept & Send to Hotels (save adjusted values) â€” COMPLETE REPLACEMENT\n\n  function onAccept() {\n    try {\n      const toSave = adjustedResult && adjustedResult.adjustedSegments ? {\n        ...adjustedResult,\n        // âœ… FINAL CANONICAL SEGMENTS (SCREEN = SAVE)\n        segments: adjustedResult.adjustedSegments.map(s => {\n          if (s.type !== \"stay\") return s;\n          const checkInIso = s.countedCheckInIso;\n          const checkOutIso = s.countedLastNightIso ? addDaysIso(s.countedLastNightIso, 1) : s.isoCheckOut;\n          return {\n            ...s,\n            // ðŸ”¥ overwrite auto planner dates\n            isoCheckIn: checkInIso,\n            isoCheckOut: checkOutIso,\n            checkIn: {\n              ...(s.checkIn || {}),\n              iso: checkInIso\n            },\n            checkOut: {\n              ...(s.checkOut || {}),\n              iso: checkOutIso\n            }\n          };\n        })\n      } : result;\n      if (!toSave) {\n        setNote(\"No itinerary to save.\");\n        return;\n      }\n\n      // Save full plan for reference\n      localStorage.setItem(\"umrah_last_plan\", JSON.stringify(toSave));\n\n      // Build staysList from adjustedStays if present, otherwise from segments\n      let staysList = [];\n      if (Array.isArray(toSave.adjustedStays) && toSave.adjustedStays.length > 0) {\n        staysList = toSave.adjustedStays;\n      } else if (Array.isArray(toSave.adjustedSegments) && toSave.adjustedSegments.length > 0) {\n        staysList = toSave.adjustedSegments.filter(s => s.type === \"stay\");\n      } else {\n        staysList = (toSave.segments || []).filter(s => s.type === \"stay\");\n      }\n\n      // Aggregate totals across stays (countedDays) for backward-compat total\n      const totalMakkah = staysList.filter(s => String(s.city).toLowerCase() === \"makkah\").reduce((acc, s) => {\n        var _ref3, _ref4, _s$countedDays2;\n        return acc + Number((_ref3 = (_ref4 = (_s$countedDays2 = s.countedDays) !== null && _s$countedDays2 !== void 0 ? _s$countedDays2 : s.displayDays) !== null && _ref4 !== void 0 ? _ref4 : s.days) !== null && _ref3 !== void 0 ? _ref3 : 0);\n      }, 0);\n      const totalMadinah = staysList.filter(s => String(s.city).toLowerCase() === \"madinah\").reduce((acc, s) => {\n        var _ref5, _ref6, _s$countedDays3;\n        return acc + Number((_ref5 = (_ref6 = (_s$countedDays3 = s.countedDays) !== null && _s$countedDays3 !== void 0 ? _s$countedDays3 : s.displayDays) !== null && _ref6 !== void 0 ? _ref6 : s.days) !== null && _ref5 !== void 0 ? _ref5 : 0);\n      }, 0);\n\n      // Save backward-compatible overall totals (counted nights)\n      localStorage.setItem(\"umrah_makkah_nights\", String(totalMakkah));\n      localStorage.setItem(\"umrah_madinah_nights\", String(totalMadinah));\n\n      // Group stays per city\n      const makkahStays = staysList.filter(s => String(s.city).toLowerCase() === \"makkah\");\n      const madinahStays = staysList.filter(s => String(s.city).toLowerCase() === \"madinah\");\n\n      // Helper: compute totals from an array of stays\n      const computeTotals = arr => {\n        let totalNights = 0;\n        let weekendNights = 0;\n        arr.forEach(s => {\n          var _ref7, _ref8, _s$countedDays4;\n          // prefer countedNights array length if present\n          const t = Array.isArray(s.countedNights) ? s.countedNights.length : Number((_ref7 = (_ref8 = (_s$countedDays4 = s.countedDays) !== null && _s$countedDays4 !== void 0 ? _s$countedDays4 : s.displayDays) !== null && _ref8 !== void 0 ? _ref8 : s.days) !== null && _ref7 !== void 0 ? _ref7 : 0);\n          const w = Array.isArray(s.weekendDates) ? s.weekendDates.length : 0;\n          totalNights += Number(t || 0);\n          weekendNights += Number(w || 0);\n        });\n        return {\n          totalNights,\n          weekendNights\n        };\n      };\n      const makkahTotals = computeTotals(makkahStays);\n      const madinahTotals = computeTotals(madinahStays);\n\n      // Save aggregated values in the shape Manage Hotels expects:\n      // - <prefix>_nights  => weeknights (total minus weekend)\n      // - <prefix>_weekend_nights => weekend nights\n      const saveAggregated = (prefix, totals) => {\n        const totalN = totals.totalNights || 0;\n        const weekendN = totals.weekendNights || 0;\n        const weekN = Math.max(0, totalN - weekendN);\n        localStorage.setItem(`${prefix}_nights`, String(weekN));\n        localStorage.setItem(`${prefix}_weekend_nights`, String(weekendN));\n      };\n      saveAggregated(\"umrah_makkah\", makkahTotals);\n      saveAggregated(\"umrah_madinah\", madinahTotals);\n\n      // Also save representative price and weekend price if present (take from first stay that has it)\n      const pickPrice = arr => {\n        for (let s of arr) {\n          if (s.pricePerNight !== undefined && s.pricePerNight !== \"\") return s.pricePerNight;\n          if (s.countedPrice !== undefined && s.countedPrice !== \"\") return s.countedPrice;\n        }\n        return null;\n      };\n      const pickWeekendPrice = arr => {\n        for (let s of arr) {\n          if (s.weekendPrice !== undefined && s.weekendPrice !== \"\") return s.weekendPrice;\n        }\n        return null;\n      };\n      const mPrice = pickPrice(makkahStays);\n      const mWeekendPrice = pickWeekendPrice(makkahStays);\n      if (mPrice !== null) localStorage.setItem(\"umrah_makkah_price\", String(mPrice));\n      if (mWeekendPrice !== null) localStorage.setItem(\"umrah_makkah_weekend_price\", String(mWeekendPrice));\n      const dPrice = pickPrice(madinahStays);\n      const dWeekendPrice = pickWeekendPrice(madinahStays);\n      if (dPrice !== null) localStorage.setItem(\"umrah_madinah_price\", String(dPrice));\n      if (dWeekendPrice !== null) localStorage.setItem(\"umrah_madinah_weekend_price\", String(dWeekendPrice));\n\n      // Save checkin/checkout ISO for each city (use first stay as representative)\n      if (makkahStays.length > 0) {\n        var _s$checkIn2, _s$checkOut2;\n        const s = makkahStays[0];\n        const isoIn = s.countedCheckInIso || s.isoCheckIn || ((_s$checkIn2 = s.checkIn) === null || _s$checkIn2 === void 0 ? void 0 : _s$checkIn2.iso);\n        const isoOut = s.countedLastNightIso ? addDaysIso(s.countedLastNightIso, 1) : s.isoCheckOut || ((_s$checkOut2 = s.checkOut) === null || _s$checkOut2 === void 0 ? void 0 : _s$checkOut2.iso);\n        if (isoIn) localStorage.setItem(\"umrah_makkah_checkin\", isoIn);\n        if (isoOut) localStorage.setItem(\"umrah_makkah_checkout\", isoOut);\n      } else {\n        // remove stale keys if no stay\n        localStorage.removeItem(\"umrah_makkah_checkin\");\n        localStorage.removeItem(\"umrah_makkah_checkout\");\n      }\n      if (madinahStays.length > 0) {\n        var _s$checkIn3, _s$checkOut3;\n        const s = madinahStays[0];\n        const isoIn = s.countedCheckInIso || s.isoCheckIn || ((_s$checkIn3 = s.checkIn) === null || _s$checkIn3 === void 0 ? void 0 : _s$checkIn3.iso);\n        const isoOut = s.countedLastNightIso ? addDaysIso(s.countedLastNightIso, 1) : s.isoCheckOut || ((_s$checkOut3 = s.checkOut) === null || _s$checkOut3 === void 0 ? void 0 : _s$checkOut3.iso);\n        if (isoIn) localStorage.setItem(\"umrah_madinah_checkin\", isoIn);\n        if (isoOut) localStorage.setItem(\"umrah_madinah_checkout\", isoOut);\n      } else {\n        localStorage.removeItem(\"umrah_madinah_checkin\");\n        localStorage.removeItem(\"umrah_madinah_checkout\");\n      }\n\n      // Navigate back to Umrah Calculator\n      navigate(\"/umrah-calculator\");\n    } catch (err) {\n      console.error(\"Save plan failed:\", err);\n      setNote(\"Failed to save plan. LocalStorage may be full.\");\n    }\n  }\n\n  // Reset display when user manually edits dates\n  useEffect(() => {\n    // if user edits originalDeparture we want displayDeparture to follow until generate is pressed\n    setDisplayDeparture(originalDeparture);\n  }, [originalDeparture]); // eslint-disable-line\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-gradient-to-b from-white to-gray-50 p-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => navigate(-1),\n      className: \"inline-flex items-center gap-2 px-4 py-2 mb-4 bg-gray-200 hover:bg-gray-300 rounded-md text-sm\",\n      children: \"\\u2190 Back\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 754,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-4xl mx-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between mb-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-3xl font-extrabold bg-gradient-to-r from-teal-600 to-indigo-600 bg-clip-text text-transparent\",\n            children: \"Trip Planner\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 765,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-indigo-600 font-medium mt-1\",\n            children: \"Create your complete Makkah + Madinah itinerary\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 768,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 764,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-3\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm px-3 py-2 rounded-md text-white bg-gradient-to-r from-indigo-500 to-teal-500 shadow\",\n            children: \"Smart Auto Planner\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 774,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 773,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 763,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded shadow p-6\",\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: onGenerate,\n          className: \"space-y-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-semibold text-gray-700\",\n              children: \"Departure Date\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 785,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"date\",\n              value: displayDeparture,\n              onChange: e => {\n                // when user edits the date manually in input, treat it as changing original\n                onDepartureChange(e.target.value);\n              },\n              className: \"mt-1 block w-full border rounded p-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 788,\n              columnNumber: 15\n            }, this), excludeArrival && originalDeparture && originalDeparture !== displayDeparture && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mt-1 text-sm bg-gradient-to-r from-red-500 via-red-600 to-rose-600 text-white p-2 rounded\",\n              children: [\"Note: The original check-in date was\", \" \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: originalDeparture\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 803,\n                columnNumber: 21\n              }, this), \" \\u2014 the first night was excluded; the current check-in will be counted:\", \" \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: displayDeparture\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 805,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 801,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 784,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-3 gap-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-semibold text-gray-700\",\n                children: \"Preset Days\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 813,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                value: totalDays,\n                onChange: e => setTotalDays(e.target.value),\n                disabled: useCustomTotal || useExitDate,\n                className: \"mt-1 block w-full border rounded p-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 15,\n                  children: \"15 Days\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 822,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 21,\n                  children: \"21 Days\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 823,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 28,\n                  children: \"28 Days\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 824,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 816,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 812,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-semibold text-gray-700\",\n                children: \"Custom Total Days\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 830,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center mt-1 gap-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: useCustomTotal,\n                  onChange: e => {\n                    setUseCustomTotal(e.target.checked);\n                    if (e.target.checked) setUseExitDate(false);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 834,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  min: 1,\n                  value: customTotal,\n                  onChange: e => setCustomTotal(e.target.value),\n                  disabled: !useCustomTotal,\n                  className: \"border rounded p-2 w-full\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 842,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 833,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 829,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-semibold text-gray-700\",\n                children: \"Set Exit Date\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 855,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center mt-1 gap-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: useExitDate,\n                  onChange: e => {\n                    setUseExitDate(e.target.checked);\n                    if (e.target.checked) setUseCustomTotal(false);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 859,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"date\",\n                  value: displayExit || exitDateInput,\n                  onChange: e => {\n                    setExitDateInput(e.target.value);\n                    onExitChange(e.target.value);\n                  },\n                  disabled: !useExitDate,\n                  className: \"border rounded p-2 w-full\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 867,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 858,\n                columnNumber: 17\n              }, this), excludeExit && displayExit && originalExitDate && displayExit !== originalExitDate && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mt-1 text-sm bg-gradient-to-r from-red-500 via-red-600 to-rose-600 text-white p-2 rounded\",\n                children: [\"Note: The original departure date was\", \" \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: originalExitDate || displayExit\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 885,\n                  columnNumber: 23\n                }, this), \" \\u2014 the last night was counted; Counted last night:\", \" \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: displayExit\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 887,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 883,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 854,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 811,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-3 gap-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-semibold text-gray-700\",\n                children: \"Start City\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 896,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                value: startCity,\n                onChange: e => setStartCity(e.target.value),\n                className: \"mt-1 block w-full border rounded p-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"makkah\",\n                  children: \"Makkah\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 904,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"madinah\",\n                  children: \"Madinah\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 905,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 899,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 895,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-semibold text-gray-700\",\n                children: \"Exit City\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 910,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                value: exitCity,\n                onChange: e => setExitCity(e.target.value),\n                className: \"mt-1 block w-full border rounded p-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"makkah\",\n                  children: \"Makkah\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 918,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"madinah\",\n                  children: \"Madinah\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 919,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 913,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 909,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-semibold text-gray-700\",\n                children: \"Max MED Nights\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 924,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"checkbox\",\n                checked: maxMadinah,\n                onChange: e => setMaxMadinah(e.target.checked),\n                className: \"mt-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 927,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 923,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 894,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"\\r flex flex-col\\r sm:flex-row\\r sm:items-center\\r gap-2 sm:gap-6\\r text-sm\\r \",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"flex items-center gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"checkbox\",\n                checked: excludeArrival,\n                onChange: e => setExcludeArrival(e.target.checked)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 947,\n                columnNumber: 17\n              }, this), \"Exclude arrival night\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 946,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"flex items-center gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"checkbox\",\n                checked: excludeExit,\n                onChange: e => setExcludeExit(e.target.checked)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 956,\n                columnNumber: 17\n              }, this), \"Exclude Exit night\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 955,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"flex items-center gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"checkbox\",\n                checked: markWeekend,\n                onChange: e => setMarkWeekend(e.target.checked)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 965,\n                columnNumber: 17\n              }, this), \"Mark weekend nights\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 964,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 937,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-semibold text-gray-700\",\n              children: \"Theme Color\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 976,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-2 mt-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                onClick: () => setTheme(\"bg-teal-600\"),\n                className: \"w-8 h-8 rounded bg-teal-600 border-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 980,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                onClick: () => setTheme(\"bg-indigo-600\"),\n                className: \"w-8 h-8 rounded bg-indigo-600 border-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 985,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                onClick: () => setTheme(\"bg-rose-500\"),\n                className: \"w-8 h-8 rounded bg-rose-500 border-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 990,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                onClick: () => setTheme(\"bg-amber-500\"),\n                className: \"w-8 h-8 rounded bg-amber-500 border-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 995,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 979,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 975,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex space-x-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"px-4 py-2 bg-indigo-600 text-white rounded\",\n              children: \"Generate Itinerary\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1005,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => {\n                setResult(null);\n                setAdjustedResult(null);\n                setNote(\"\");\n                setUseCustomTotal(false);\n                setUseExitDate(false);\n                setOriginalDeparture(localToday);\n                setDisplayDeparture(localToday);\n                setOriginalExitDate(\"\");\n                setDisplayExit(\"\");\n                setExitDateInput(\"\");\n                setExcludeArrival(false);\n                setExcludeExit(false);\n                setMarkWeekend(false);\n              },\n              className: \"px-4 py-2 border rounded\",\n              children: \"Reset\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1012,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1004,\n            columnNumber: 13\n          }, this), note && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-2 text-sm bg-yellow-50 p-2 rounded text-gray-700\",\n            children: note\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1036,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 782,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 781,\n        columnNumber: 9\n      }, this), manualStays && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-4 bg-white rounded shadow p-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-sm font-semibold mb-3\",\n          children: \"Manual Days Adjustment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1044,\n          columnNumber: 13\n        }, this), manualStays.map((s, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between border-b py-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"capitalize flex items-center gap-2\",\n            children: [s.city, \" stay \", i + 1, manualStays.length === 3 && /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"text-xs flex items-center gap-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"checkbox\",\n                checked: s.locked,\n                onChange: () => {\n                  setManualStays(prev => prev.map((x, idx) => idx === i ? {\n                    ...x,\n                    locked: !x.locked\n                  } : x));\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1057,\n                columnNumber: 23\n              }, this), \"Lock\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1056,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1053,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => onManualAdjust(i, -1),\n              className: \"px-2 py-1 border rounded\",\n              children: \"\\u2212\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1074,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"w-6 text-center\",\n              children: s.displayDays\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1080,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => onManualAdjust(i, +1),\n              className: \"px-2 py-1 border rounded\",\n              children: \"+\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1081,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1073,\n            columnNumber: 17\n          }, this)]\n        }, i, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1049,\n          columnNumber: 15\n        }, this)), manualFridayWarning && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-3 p-2 text-sm rounded bg-red-100 text-red-700\",\n          children: \"\\u26A0\\uFE0F Manual adjustment ki wajah se travel day Friday ban raha hai. Barah-e-karam aik din kam ya zyada karein.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1092,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1043,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-6\",\n        children: result ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-4\",\n            children: /*#__PURE__*/_jsxDEV(TripSummaryCard, {\n              data: adjustedResult || result,\n              raw: result,\n              excludeArrival: excludeArrival,\n              excludeExit: excludeExit,\n              markWeekend: markWeekend,\n              themeClass: theme,\n              onAccept: () => onAccept()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1105,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1104,\n            columnNumber: 15\n          }, this)\n        }, void 0, false) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"max-w-4xl mx-auto p-6 text-center text-gray-600\",\n          children: \"Generate a plan to see results here.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1117,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1101,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 761,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 752,\n    columnNumber: 5\n  }, this);\n}\n_s(TripPlanner, \"QinhWU9ppP1wNFfZetwS09b7k6E=\", false, function () {\n  return [useNavigate];\n});\n_c = TripPlanner;\nvar _c;\n$RefreshReg$(_c, \"TripPlanner\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","generateItinerary","TripSummaryCard","adjustStaysManually","jsxDEV","_jsxDEV","Fragment","_Fragment","isoToDate","iso","parts","String","split","yyyy","Number","mm","dd","Date","dateToIso","d","getFullYear","getMonth","padStart","getDate","addDaysIso","n","dt","setDate","rebuildPreviewFromManual","adjustedResult","manualStays","_manualStays$","_next$adjustedStays$","next","JSON","parse","stringify","cursor","isoCheckIn","adjustedStays","countedCheckInIso","forEach","s","i","m","nights","displayDays","countedDays","lastNight","countedLastNightIso","rebuildSegmentsFromStays","segments","push","type","city","originalDays","checkIn","checkOut","isoCheckOut","isoLastNight","countedNights","weekendDates","length","travelIso","date","human","days","mon","toLocaleString","month","getDay","adjustedSegments","buildAdjustedResult","result","excludeArrival","excludeExit","markWeekend","segs","stays","filter","map","idx","_s$checkIn","_s$displayDays","_ref","_s$displayDays2","_s$displayDays3","Math","max","cur","last","day","_s$checkOut","makkahNights","madinahNights","countedTotal","_s$countedDays","TripPlanner","_s","now","localToday","originalDeparture","setOriginalDeparture","originalExitDate","setOriginalExitDate","displayDeparture","setDisplayDeparture","displayExit","setDisplayExit","totalDays","setTotalDays","useCustomTotal","setUseCustomTotal","customTotal","setCustomTotal","useExitDate","setUseExitDate","exitDateInput","setExitDateInput","startCity","setStartCity","exitCity","setExitCity","maxMadinah","setMaxMadinah","setExcludeArrival","setExcludeExit","setMarkWeekend","setResult","setAdjustedResult","note","setNote","setManualStays","manualFridayWarning","setManualFridayWarning","theme","setTheme","navigate","toLocalIso","val","test","isNaN","getTime","onDepartureChange","v","onExitChange","onGenerate","e","_e$preventDefault","_coreLastStay$checkOu","preventDefault","call","opts","departureDate","exitDate","res","error","adj","_ref2","_s$originalDays","locked","firstStay","coreLastStay","slice","coreExitIso","isoCheckOutDay","lastAdjStay","_coreLastStay$checkOu2","onManualAdjust","stayIndex","delta","_newAdjusted$adjusted","fridayWarning","balanceWarning","newAdjusted","manual","end","previewStays","previewFinal","onAccept","toSave","checkInIso","checkOutIso","localStorage","setItem","staysList","Array","isArray","totalMakkah","toLowerCase","reduce","acc","_ref3","_ref4","_s$countedDays2","totalMadinah","_ref5","_ref6","_s$countedDays3","makkahStays","madinahStays","computeTotals","arr","totalNights","weekendNights","_ref7","_ref8","_s$countedDays4","t","w","makkahTotals","madinahTotals","saveAggregated","prefix","totals","totalN","weekendN","weekN","pickPrice","pricePerNight","undefined","countedPrice","pickWeekendPrice","weekendPrice","mPrice","mWeekendPrice","dPrice","dWeekendPrice","_s$checkIn2","_s$checkOut2","isoIn","isoOut","removeItem","_s$checkIn3","_s$checkOut3","err","console","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","value","onChange","target","disabled","checked","min","prev","x","data","raw","themeClass","_c","$RefreshReg$"],"sources":["C:/Users/Taj Tech/Downloads/umrah-calculator/src/pages/TripPlanner.jsx"],"sourcesContent":["// src/pages/TripPlanner.jsx\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { generateItinerary } from \"../utils/dateHelpers\";\r\nimport TripSummaryCard from \"../components/TripPlanner/TripSummaryCard\";\r\nimport { adjustStaysManually } from \"../utils/manualAdjuster\";\r\n\r\n/**\r\n * TripPlanner page (UI)\r\n * - Supports exclude first/last night and shows counted dates in calendar (display).\r\n * - Shows notes about original dates when excluded.\r\n * - Mark weekend nights (Thu + Fri) based on counted nights.\r\n * - Removes Jeddah option from city dropdown.\r\n *\r\n * Important:\r\n * - generateItinerary remains core calculation.\r\n * - This UI builds adjustedResult from core result and toggles, and updates displayed dates.\r\n */\r\n\r\n/* Safe ISO helpers: avoid timezone shifts by splitting */\r\nfunction isoToDate(iso) {\r\n  if (!iso) return null;\r\n  const parts = String(iso).split(\"-\");\r\n  const yyyy = Number(parts[0]);\r\n  const mm = Number(parts[1]) - 1;\r\n  const dd = Number(parts[2]);\r\n  return new Date(yyyy, mm, dd);\r\n}\r\n\r\nfunction dateToIso(d) {\r\n  if (!d) return \"\";\r\n  const yyyy = d.getFullYear();\r\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const dd = String(d.getDate()).padStart(2, \"0\");\r\n  return `${yyyy}-${mm}-${dd}`;\r\n}\r\n\r\nfunction addDaysIso(iso, n) {\r\n  const dt = isoToDate(iso);\r\n  if (!dt) return iso;\r\n  const d = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate());\r\n  d.setDate(d.getDate() + n);\r\n  return dateToIso(d);\r\n}\r\n/**\r\n * ðŸ” Recalculate preview stays dates\r\n * based on MANUAL counted days\r\n *\r\n * Live preview ONLY â€” final commit on Accept\r\n */\r\nfunction rebuildPreviewFromManual(adjustedResult, manualStays) {\r\n  if (!adjustedResult || !manualStays) return adjustedResult;\r\n\r\n  const next = JSON.parse(JSON.stringify(adjustedResult));\r\n\r\n  let cursor =\r\n    manualStays[0]?.isoCheckIn || next.adjustedStays[0]?.countedCheckInIso;\r\n\r\n  next.adjustedStays.forEach((s, i) => {\r\n    const m = manualStays[i];\r\n    const nights = m.displayDays;\r\n\r\n    s.countedDays = nights;\r\n    s.countedCheckInIso = cursor;\r\n\r\n    const lastNight = addDaysIso(cursor, nights - 1);\r\n    s.countedLastNightIso = lastNight;\r\n\r\n    cursor = addDaysIso(lastNight, 1);\r\n  });\r\n\r\n  return next;\r\n}\r\n\r\n/**\r\n * ðŸ” Build adjustedSegments from adjustedStays\r\n * So UI dates (check-in / check-out / travel)\r\n * update immediately on manual + / âˆ’\r\n */\r\nfunction rebuildSegmentsFromStays(adjustedResult) {\r\n  if (!adjustedResult || !adjustedResult.adjustedStays) return adjustedResult;\r\n\r\n  const next = JSON.parse(JSON.stringify(adjustedResult));\r\n  const segments = [];\r\n\r\n  next.adjustedStays.forEach((s, i) => {\r\n    // stay segment (FULL SHAPE)\r\n    segments.push({\r\n      type: \"stay\",\r\n      city: s.city,\r\n\r\n      originalDays: s.originalDays,\r\n      countedDays: s.countedDays,\r\n\r\n      // calendar dates (original)\r\n      checkIn: s.checkIn,\r\n      checkOut: s.checkOut,\r\n\r\n      isoCheckIn: s.isoCheckIn,\r\n      isoCheckOut: s.isoCheckOut,\r\n      isoLastNight: s.isoLastNight,\r\n\r\n      // counted dates (manual/exclude aware)\r\n      countedCheckInIso: s.countedCheckInIso,\r\n      countedLastNightIso: s.countedLastNightIso,\r\n\r\n      countedNights: s.countedNights || [],\r\n      weekendDates: s.weekendDates || [],\r\n    });\r\n\r\n    // travel segment\r\n    if (i < next.adjustedStays.length - 1) {\r\n      const travelIso = addDaysIso(s.countedLastNightIso, 1);\r\n      segments.push({\r\n        type: \"travel\",\r\n        iso: travelIso,\r\n        date: {\r\n          iso: travelIso,\r\n          human: travelIso\r\n            ? (() => {\r\n                const d = isoToDate(travelIso);\r\n                const days = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\r\n                const mon = d.toLocaleString(\"en-US\", { month: \"short\" });\r\n                return `${String(d.getDate()).padStart(2, \"0\")} ${mon} (${\r\n                  days[d.getDay()]\r\n                })`;\r\n              })()\r\n            : \"â€”\",\r\n        },\r\n      });\r\n    }\r\n  });\r\n\r\n  next.adjustedSegments = segments;\r\n  return next;\r\n}\r\n\r\n/**\r\n * Build adjusted result for UI:\r\n * - applies excludeArrival/excludeExit\r\n * - computes countedCheckInIso / countedLastNightIso per stay\r\n * - computes weekendDates per stay (Thu+Fri) based on counted nights\r\n */\r\nfunction buildAdjustedResult(result, excludeArrival, excludeExit, markWeekend) {\r\n  if (!result) return null;\r\n  const segs = JSON.parse(JSON.stringify(result.segments || []));\r\n\r\n  // stays only\r\n  const stays = segs.filter((s) => s.type === \"stay\");\r\n\r\n  // create adjusted stays\r\n  const adjustedStays = stays.map((s, idx) => {\r\n    const isoCheckIn = s.isoCheckIn || s.checkIn?.iso;\r\n    const isoLastNight =\r\n      (s.lastNight && (s.lastNight.iso || s.lastNight)) ||\r\n      addDaysIso(isoCheckIn, (s.displayDays ?? s.days) - 1);\r\n\r\n    let countedDays = Number(s.displayDays ?? s.days ?? 0);\r\n\r\n    if (excludeArrival && idx === 0) {\r\n      countedDays = Math.max(0, countedDays - 1);\r\n    }\r\n    if (excludeExit && idx === stays.length - 1) {\r\n      countedDays = Math.max(0, countedDays - 1);\r\n    }\r\n\r\n    const countedCheckInIso =\r\n      excludeArrival && idx === 0 ? addDaysIso(isoCheckIn, 1) : isoCheckIn;\r\n\r\n    const countedLastNightIso = (() => {\r\n      if (excludeExit && idx === stays.length - 1) {\r\n        // if exclude last night, move lastNight back one day\r\n        return addDaysIso(isoLastNight, -1);\r\n      }\r\n      // otherwise count from countedCheckInIso + (countedDays - 1)\r\n      return addDaysIso(countedCheckInIso, Math.max(0, countedDays - 1));\r\n    })();\r\n\r\n    // build counted nights array for this stay (every counted night iso)\r\n    const countedNights = [];\r\n    if (countedDays > 0) {\r\n      let cur = isoToDate(countedCheckInIso);\r\n      const last = isoToDate(countedLastNightIso);\r\n      while (cur && last && cur <= last) {\r\n        countedNights.push(dateToIso(cur));\r\n        cur.setDate(cur.getDate() + 1);\r\n      }\r\n    }\r\n\r\n    // weekend detection (Thu=4, Fri=5)\r\n    const weekendDates = [];\r\n    if (markWeekend && countedNights.length > 0) {\r\n      countedNights.forEach((iso) => {\r\n        const d = isoToDate(iso);\r\n        const day = d.getDay();\r\n        if (day === 4 || day === 5) weekendDates.push(iso);\r\n      });\r\n    }\r\n\r\n    return {\r\n      ...s,\r\n      countedDays,\r\n      countedCheckInIso,\r\n      countedLastNightIso,\r\n      countedNights,\r\n      weekendDates,\r\n      originalDays: s.displayDays ?? s.days,\r\n    };\r\n  });\r\n\r\n  // build adjusted segments (stay + travel) for display\r\n  const adjustedSegments = [];\r\n  for (let i = 0; i < adjustedStays.length; i++) {\r\n    const s = adjustedStays[i];\r\n    adjustedSegments.push({\r\n      type: \"stay\",\r\n      city: s.city,\r\n      originalDays: s.originalDays,\r\n      countedDays: s.countedDays,\r\n      checkIn: s.checkIn, // original formatted\r\n      checkOut: s.checkOut, // original formatted (we keep)\r\n      isoCheckIn: s.isoCheckIn,\r\n      isoCheckOut: s.isoCheckOut,\r\n      countedCheckInIso: s.countedCheckInIso,\r\n      countedLastNightIso: s.countedLastNightIso,\r\n      countedNights: s.countedNights,\r\n      weekendDates: s.weekendDates,\r\n    });\r\n    if (i < adjustedStays.length - 1) {\r\n      // find corresponding travel seg (fallback to s.checkOut)\r\n      adjustedSegments.push({\r\n        type: \"travel\",\r\n        date: s.checkOut,\r\n        iso: s.isoCheckOut || s.checkOut?.iso,\r\n      });\r\n    }\r\n  }\r\n\r\n  // compute per-city totals (based on countedNights)\r\n  let makkahNights = 0,\r\n    madinahNights = 0,\r\n    countedTotal = 0;\r\n  adjustedStays.forEach((s) => {\r\n    const d = s.countedDays ?? 0;\r\n    countedTotal += d;\r\n    if (s.city === \"makkah\") makkahNights += d;\r\n    if (s.city === \"madinah\") madinahNights += d;\r\n  });\r\n\r\n  return {\r\n    ...result,\r\n    adjustedSegments,\r\n    adjustedStays,\r\n    countedTotal,\r\n    makkahNights,\r\n    madinahNights,\r\n  };\r\n}\r\n\r\nexport default function TripPlanner() {\r\n  const now = new Date();\r\n  const localToday = `${now.getFullYear()}-${String(\r\n    now.getMonth() + 1\r\n  ).padStart(2, \"0\")}-${String(now.getDate()).padStart(2, \"0\")}`;\r\n\r\n  // original values (what user inputs)\r\n  const [originalDeparture, setOriginalDeparture] = useState(localToday);\r\n  const [originalExitDate, setOriginalExitDate] = useState(\"\");\r\n\r\n  // displayed calendar values (may be adjusted when excludes used)\r\n  const [displayDeparture, setDisplayDeparture] = useState(localToday);\r\n  const [displayExit, setDisplayExit] = useState(\"\");\r\n\r\n  const [totalDays, setTotalDays] = useState(15);\r\n  const [useCustomTotal, setUseCustomTotal] = useState(false);\r\n  const [customTotal, setCustomTotal] = useState(15);\r\n  const [useExitDate, setUseExitDate] = useState(false);\r\n  const [exitDateInput, setExitDateInput] = useState(\"\");\r\n\r\n  const [startCity, setStartCity] = useState(\"makkah\");\r\n  const [exitCity, setExitCity] = useState(\"makkah\");\r\n  const [maxMadinah, setMaxMadinah] = useState(false);\r\n\r\n  // NEW UI flags:\r\n  const [excludeArrival, setExcludeArrival] = useState(false);\r\n  const [excludeExit, setExcludeExit] = useState(false);\r\n  const [markWeekend, setMarkWeekend] = useState(false); // Thu+Fri\r\n\r\n  const [result, setResult] = useState(null);\r\n  const [adjustedResult, setAdjustedResult] = useState(null);\r\n  const [note, setNote] = useState(\"\");\r\n  // Manual adjustment state\r\n  const [manualStays, setManualStays] = useState(null);\r\n  const [manualFridayWarning, setManualFridayWarning] = useState(false);\r\n\r\n  const [theme, setTheme] = useState(\"bg-teal-600\");\r\n  const navigate = useNavigate();\r\n\r\n  // normalize helpers: ensure passing YYYY-MM-DD to core\r\n  function toLocalIso(val) {\r\n    if (!val) return val;\r\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(val)) return val;\r\n    const d = new Date(val);\r\n    if (isNaN(d.getTime())) return val;\r\n    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(\r\n      2,\r\n      \"0\"\r\n    )}-${String(d.getDate()).padStart(2, \"0\")}`;\r\n  }\r\n\r\n  // When user changes the departure input, keep original and display in sync\r\n  function onDepartureChange(v) {\r\n    setOriginalDeparture(v);\r\n    setDisplayDeparture(v);\r\n  }\r\n  function onExitChange(v) {\r\n    setOriginalExitDate(v);\r\n    setDisplayExit(v);\r\n    setExitDateInput(v);\r\n  }\r\n\r\n  // Create itinerary\r\n  function onGenerate(e) {\r\n    e?.preventDefault?.();\r\n    setNote(\"\");\r\n\r\n    const opts = {\r\n      departureDate: toLocalIso(originalDeparture),\r\n      startCity,\r\n      exitCity,\r\n      maxMadinah,\r\n    };\r\n\r\n    if (useExitDate && exitDateInput) {\r\n      opts.exitDate = toLocalIso(exitDateInput);\r\n    } else if (useCustomTotal) {\r\n      opts.totalDays = Number(customTotal);\r\n    } else {\r\n      opts.totalDays = Number(totalDays);\r\n    }\r\n\r\n    const res = generateItinerary(opts);\r\n\r\n    if (res.error) {\r\n      setNote(res.error);\r\n      setResult(null);\r\n      setAdjustedResult(null);\r\n      return;\r\n    }\r\n\r\n    setResult(res);\r\n\r\n    // build adjusted result based on UI flags\r\n    const adj = buildAdjustedResult(\r\n      res,\r\n      excludeArrival,\r\n      excludeExit,\r\n      markWeekend\r\n    );\r\n    setAdjustedResult(adj);\r\n    // initialize manual stays from adjusted stays\r\n    if (adj?.adjustedStays) {\r\n      setManualStays(\r\n        adj.adjustedStays.map((s) => ({\r\n          city: s.city,\r\n\r\n          // âœ… IMPORTANT:\r\n          // Manual system ab COUNTED nights se start karega\r\n          displayDays:\r\n            typeof s.countedDays === \"number\"\r\n              ? s.countedDays\r\n              : s.originalDays ?? s.displayDays ?? s.days,\r\n\r\n          isoCheckIn: s.countedCheckInIso || s.isoCheckIn,\r\n          locked: false,\r\n        }))\r\n      );\r\n\r\n      setManualFridayWarning(false);\r\n    }\r\n\r\n    // Update displayed calendar values depending on exclude flags:\r\n    // Display departure as countedCheckIn of first stay if excludeArrival, else originalDeparture (or core departure iso)\r\n    const firstStay =\r\n      (adj && adj.adjustedStays && adj.adjustedStays[0]) || null;\r\n    if (firstStay) {\r\n      if (excludeArrival) {\r\n        setDisplayDeparture(\r\n          firstStay.countedCheckInIso ||\r\n            firstStay.isoCheckIn ||\r\n            originalDeparture\r\n        );\r\n      } else {\r\n        // Use originalDeparture (user-chosen) or normalized core departure\r\n        setDisplayDeparture(toLocalIso(originalDeparture));\r\n      }\r\n    }\r\n\r\n    // Compute original exit iso from core result (last stay lastNight)\r\n    const coreLastStay = res.segments\r\n      ? res.segments.filter((s) => s.type === \"stay\").slice(-1)[0]\r\n      : null;\r\n\r\n    // UPDATED: prefer last night as exit date for form\r\n    const coreExitIso = coreLastStay\r\n      ? coreLastStay.isoLastNight ||\r\n        coreLastStay.isoCheckOutDay ||\r\n        coreLastStay.checkOut?.iso ||\r\n        \"\"\r\n      : \"\";\r\n\r\n    // For displayExit: if excludeExit true -> show countedLastNight of last adjusted stay\r\n    const lastAdjStay =\r\n      (adj && adj.adjustedStays && adj.adjustedStays.slice(-1)[0]) || null;\r\n    if (lastAdjStay) {\r\n      if (excludeExit) {\r\n        setDisplayExit(\r\n          lastAdjStay.countedLastNightIso ||\r\n            lastAdjStay.isoCheckOut ||\r\n            coreExitIso\r\n        );\r\n      } else {\r\n        // show original exit (from core)\r\n        setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\r\n      }\r\n    } else {\r\n      setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\r\n    }\r\n\r\n    setNote(\"Itinerary generated successfully.\");\r\n  }\r\n\r\n  // recompute adjusted result and update display when toggles change\r\n  useEffect(() => {\r\n    if (!result) return;\r\n    const adj = buildAdjustedResult(\r\n      result,\r\n      excludeArrival,\r\n      excludeExit,\r\n      markWeekend\r\n    );\r\n    setAdjustedResult(adj);\r\n\r\n    // update display departure/exit based on current toggles\r\n    const firstStay =\r\n      (adj && adj.adjustedStays && adj.adjustedStays[0]) || null;\r\n    if (firstStay) {\r\n      if (excludeArrival)\r\n        setDisplayDeparture(\r\n          firstStay.countedCheckInIso || firstStay.isoCheckIn\r\n        );\r\n      else setDisplayDeparture(toLocalIso(originalDeparture));\r\n    }\r\n    const lastAdjStay =\r\n      (adj && adj.adjustedStays && adj.adjustedStays.slice(-1)[0]) || null;\r\n    const coreLastStay = result.segments\r\n      ? result.segments.filter((s) => s.type === \"stay\").slice(-1)[0]\r\n      : null;\r\n\r\n    // UPDATED: prefer last night as exit date for form\r\n    const coreExitIso = coreLastStay\r\n      ? coreLastStay.isoLastNight ||\r\n        coreLastStay.isoCheckOutDay ||\r\n        coreLastStay.checkOut?.iso ||\r\n        \"\"\r\n      : \"\";\r\n\r\n    if (lastAdjStay) {\r\n      if (excludeExit)\r\n        setDisplayExit(\r\n          lastAdjStay.countedLastNightIso ||\r\n            lastAdjStay.isoCheckOut ||\r\n            coreExitIso\r\n        );\r\n      else setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\r\n    } else {\r\n      setDisplayExit(coreExitIso || toLocalIso(originalExitDate) || \"\");\r\n    }\r\n    // recompute note cleared/updated\r\n  }, [excludeArrival, excludeExit, markWeekend, result]); // eslint-disable-line\r\n\r\n  function onManualAdjust(stayIndex, delta) {\r\n    if (!manualStays || !adjustedResult) return;\r\n\r\n    const { stays, fridayWarning, balanceWarning } = adjustStaysManually(\r\n      manualStays,\r\n      stayIndex,\r\n      delta\r\n    );\r\n\r\n    setManualStays(stays);\r\n    setManualFridayWarning(fridayWarning);\r\n\r\n    if (balanceWarning) return;\r\n\r\n    // -------------------------------\r\n    // ðŸ” Rebuild adjustedResult dates\r\n    // based on MANUAL counted days\r\n    // -------------------------------\r\n    const newAdjusted = JSON.parse(JSON.stringify(adjustedResult));\r\n\r\n    let cursor =\r\n      stays[0].isoCheckIn || newAdjusted.adjustedStays[0]?.countedCheckInIso;\r\n\r\n    newAdjusted.adjustedStays.forEach((s, i) => {\r\n      const manual = stays[i];\r\n      const nights = manual.displayDays;\r\n\r\n      s.countedDays = nights;\r\n      s.countedCheckInIso = cursor;\r\n\r\n      // last night = checkin + (nights - 1)\r\n      const lastNight = addDaysIso(cursor, nights - 1);\r\n      s.countedLastNightIso = lastNight;\r\n\r\n      // âœ… weekend nights ONLY if feature is ON\r\n      let weekendDates = [];\r\n\r\n      if (markWeekend) {\r\n        let d = isoToDate(s.countedCheckInIso);\r\n        const end = isoToDate(s.countedLastNightIso);\r\n\r\n        while (d && end && d <= end) {\r\n          const day = d.getDay(); // Thu=4, Fri=5\r\n          if (day === 4 || day === 5) {\r\n            weekendDates.push(dateToIso(d));\r\n          }\r\n          d.setDate(d.getDate() + 1);\r\n        }\r\n      }\r\n\r\n      s.weekendDates = weekendDates;\r\n\r\n      // next checkin = last night + 1\r\n      cursor = addDaysIso(lastNight, 1);\r\n    });\r\n\r\n    // ðŸ” Live preview: rebuild stays + segments\r\n    const previewStays = rebuildPreviewFromManual(newAdjusted, stays);\r\n    const previewFinal = rebuildSegmentsFromStays(previewStays);\r\n\r\n    setAdjustedResult(previewFinal);\r\n  }\r\n\r\n  // Accept & Send to Hotels (save adjusted values) â€” COMPLETE REPLACEMENT\r\n\r\n  function onAccept() {\r\n    try {\r\n      const toSave =\r\n        adjustedResult && adjustedResult.adjustedSegments\r\n          ? {\r\n              ...adjustedResult,\r\n\r\n              // âœ… FINAL CANONICAL SEGMENTS (SCREEN = SAVE)\r\n              segments: adjustedResult.adjustedSegments.map((s) => {\r\n                if (s.type !== \"stay\") return s;\r\n\r\n                const checkInIso = s.countedCheckInIso;\r\n                const checkOutIso = s.countedLastNightIso\r\n                  ? addDaysIso(s.countedLastNightIso, 1)\r\n                  : s.isoCheckOut;\r\n\r\n                return {\r\n                  ...s,\r\n\r\n                  // ðŸ”¥ overwrite auto planner dates\r\n                  isoCheckIn: checkInIso,\r\n                  isoCheckOut: checkOutIso,\r\n\r\n                  checkIn: {\r\n                    ...(s.checkIn || {}),\r\n                    iso: checkInIso,\r\n                  },\r\n                  checkOut: {\r\n                    ...(s.checkOut || {}),\r\n                    iso: checkOutIso,\r\n                  },\r\n                };\r\n              }),\r\n            }\r\n          : result;\r\n\r\n      if (!toSave) {\r\n        setNote(\"No itinerary to save.\");\r\n        return;\r\n      }\r\n\r\n      // Save full plan for reference\r\n      localStorage.setItem(\"umrah_last_plan\", JSON.stringify(toSave));\r\n\r\n      // Build staysList from adjustedStays if present, otherwise from segments\r\n      let staysList = [];\r\n\r\n      if (\r\n        Array.isArray(toSave.adjustedStays) &&\r\n        toSave.adjustedStays.length > 0\r\n      ) {\r\n        staysList = toSave.adjustedStays;\r\n      } else if (\r\n        Array.isArray(toSave.adjustedSegments) &&\r\n        toSave.adjustedSegments.length > 0\r\n      ) {\r\n        staysList = toSave.adjustedSegments.filter((s) => s.type === \"stay\");\r\n      } else {\r\n        staysList = (toSave.segments || []).filter((s) => s.type === \"stay\");\r\n      }\r\n\r\n      // Aggregate totals across stays (countedDays) for backward-compat total\r\n      const totalMakkah = staysList\r\n        .filter((s) => String(s.city).toLowerCase() === \"makkah\")\r\n        .reduce(\r\n          (acc, s) =>\r\n            acc + Number(s.countedDays ?? s.displayDays ?? s.days ?? 0),\r\n          0\r\n        );\r\n\r\n      const totalMadinah = staysList\r\n        .filter((s) => String(s.city).toLowerCase() === \"madinah\")\r\n        .reduce(\r\n          (acc, s) =>\r\n            acc + Number(s.countedDays ?? s.displayDays ?? s.days ?? 0),\r\n          0\r\n        );\r\n\r\n      // Save backward-compatible overall totals (counted nights)\r\n      localStorage.setItem(\"umrah_makkah_nights\", String(totalMakkah));\r\n      localStorage.setItem(\"umrah_madinah_nights\", String(totalMadinah));\r\n\r\n      // Group stays per city\r\n      const makkahStays = staysList.filter(\r\n        (s) => String(s.city).toLowerCase() === \"makkah\"\r\n      );\r\n      const madinahStays = staysList.filter(\r\n        (s) => String(s.city).toLowerCase() === \"madinah\"\r\n      );\r\n\r\n      // Helper: compute totals from an array of stays\r\n      const computeTotals = (arr) => {\r\n        let totalNights = 0;\r\n        let weekendNights = 0;\r\n        arr.forEach((s) => {\r\n          // prefer countedNights array length if present\r\n          const t = Array.isArray(s.countedNights)\r\n            ? s.countedNights.length\r\n            : Number(s.countedDays ?? s.displayDays ?? s.days ?? 0);\r\n          const w = Array.isArray(s.weekendDates) ? s.weekendDates.length : 0;\r\n          totalNights += Number(t || 0);\r\n          weekendNights += Number(w || 0);\r\n        });\r\n        return { totalNights, weekendNights };\r\n      };\r\n\r\n      const makkahTotals = computeTotals(makkahStays);\r\n      const madinahTotals = computeTotals(madinahStays);\r\n\r\n      // Save aggregated values in the shape Manage Hotels expects:\r\n      // - <prefix>_nights  => weeknights (total minus weekend)\r\n      // - <prefix>_weekend_nights => weekend nights\r\n      const saveAggregated = (prefix, totals) => {\r\n        const totalN = totals.totalNights || 0;\r\n        const weekendN = totals.weekendNights || 0;\r\n        const weekN = Math.max(0, totalN - weekendN);\r\n\r\n        localStorage.setItem(`${prefix}_nights`, String(weekN));\r\n        localStorage.setItem(`${prefix}_weekend_nights`, String(weekendN));\r\n      };\r\n\r\n      saveAggregated(\"umrah_makkah\", makkahTotals);\r\n      saveAggregated(\"umrah_madinah\", madinahTotals);\r\n\r\n      // Also save representative price and weekend price if present (take from first stay that has it)\r\n      const pickPrice = (arr) => {\r\n        for (let s of arr) {\r\n          if (s.pricePerNight !== undefined && s.pricePerNight !== \"\")\r\n            return s.pricePerNight;\r\n          if (s.countedPrice !== undefined && s.countedPrice !== \"\")\r\n            return s.countedPrice;\r\n        }\r\n        return null;\r\n      };\r\n      const pickWeekendPrice = (arr) => {\r\n        for (let s of arr) {\r\n          if (s.weekendPrice !== undefined && s.weekendPrice !== \"\")\r\n            return s.weekendPrice;\r\n        }\r\n        return null;\r\n      };\r\n\r\n      const mPrice = pickPrice(makkahStays);\r\n      const mWeekendPrice = pickWeekendPrice(makkahStays);\r\n      if (mPrice !== null)\r\n        localStorage.setItem(\"umrah_makkah_price\", String(mPrice));\r\n      if (mWeekendPrice !== null)\r\n        localStorage.setItem(\r\n          \"umrah_makkah_weekend_price\",\r\n          String(mWeekendPrice)\r\n        );\r\n\r\n      const dPrice = pickPrice(madinahStays);\r\n      const dWeekendPrice = pickWeekendPrice(madinahStays);\r\n      if (dPrice !== null)\r\n        localStorage.setItem(\"umrah_madinah_price\", String(dPrice));\r\n      if (dWeekendPrice !== null)\r\n        localStorage.setItem(\r\n          \"umrah_madinah_weekend_price\",\r\n          String(dWeekendPrice)\r\n        );\r\n\r\n      // Save checkin/checkout ISO for each city (use first stay as representative)\r\n      if (makkahStays.length > 0) {\r\n        const s = makkahStays[0];\r\n        const isoIn = s.countedCheckInIso || s.isoCheckIn || s.checkIn?.iso;\r\n        const isoOut = s.countedLastNightIso\r\n          ? addDaysIso(s.countedLastNightIso, 1)\r\n          : s.isoCheckOut || s.checkOut?.iso;\r\n        if (isoIn) localStorage.setItem(\"umrah_makkah_checkin\", isoIn);\r\n        if (isoOut) localStorage.setItem(\"umrah_makkah_checkout\", isoOut);\r\n      } else {\r\n        // remove stale keys if no stay\r\n        localStorage.removeItem(\"umrah_makkah_checkin\");\r\n        localStorage.removeItem(\"umrah_makkah_checkout\");\r\n      }\r\n\r\n      if (madinahStays.length > 0) {\r\n        const s = madinahStays[0];\r\n        const isoIn = s.countedCheckInIso || s.isoCheckIn || s.checkIn?.iso;\r\n        const isoOut = s.countedLastNightIso\r\n          ? addDaysIso(s.countedLastNightIso, 1)\r\n          : s.isoCheckOut || s.checkOut?.iso;\r\n        if (isoIn) localStorage.setItem(\"umrah_madinah_checkin\", isoIn);\r\n        if (isoOut) localStorage.setItem(\"umrah_madinah_checkout\", isoOut);\r\n      } else {\r\n        localStorage.removeItem(\"umrah_madinah_checkin\");\r\n        localStorage.removeItem(\"umrah_madinah_checkout\");\r\n      }\r\n\r\n      // Navigate back to Umrah Calculator\r\n      navigate(\"/umrah-calculator\");\r\n    } catch (err) {\r\n      console.error(\"Save plan failed:\", err);\r\n      setNote(\"Failed to save plan. LocalStorage may be full.\");\r\n    }\r\n  }\r\n\r\n  // Reset display when user manually edits dates\r\n  useEffect(() => {\r\n    // if user edits originalDeparture we want displayDeparture to follow until generate is pressed\r\n    setDisplayDeparture(originalDeparture);\r\n  }, [originalDeparture]); // eslint-disable-line\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-white to-gray-50 p-6\">\r\n      {/* Back Button */}\r\n      <button\r\n        onClick={() => navigate(-1)}\r\n        className=\"inline-flex items-center gap-2 px-4 py-2 mb-4 bg-gray-200 hover:bg-gray-300 rounded-md text-sm\"\r\n      >\r\n        â† Back\r\n      </button>\r\n\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        {/* Page header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-extrabold bg-gradient-to-r from-teal-600 to-indigo-600 bg-clip-text text-transparent\">\r\n              Trip Planner\r\n            </h1>\r\n            <p className=\"text-sm text-indigo-600 font-medium mt-1\">\r\n              Create your complete Makkah + Madinah itinerary\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"text-sm px-3 py-2 rounded-md text-white bg-gradient-to-r from-indigo-500 to-teal-500 shadow\">\r\n              Smart Auto Planner\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Form Card */}\r\n        <div className=\"bg-white rounded shadow p-6\">\r\n          <form onSubmit={onGenerate} className=\"space-y-4\">\r\n            {/* Departure Date (original vs displayed) */}\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700\">\r\n                Departure Date\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                value={displayDeparture}\r\n                onChange={(e) => {\r\n                  // when user edits the date manually in input, treat it as changing original\r\n                  onDepartureChange(e.target.value);\r\n                }}\r\n                className=\"mt-1 block w-full border rounded p-2\"\r\n              />\r\n              {/* Note area: show original if different and excluded */}\r\n              {excludeArrival &&\r\n                originalDeparture &&\r\n                originalDeparture !== displayDeparture && (\r\n                  <div className=\"mt-1 text-sm bg-gradient-to-r from-red-500 via-red-600 to-rose-600 text-white p-2 rounded\">\r\n                    Note: The original check-in date was{\" \"}\r\n                    <strong>{originalDeparture}</strong> â€” the first night was\r\n                    excluded; the current check-in will be counted:{\" \"}\r\n                    <strong>{displayDeparture}</strong>\r\n                  </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Days Options */}\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700\">\r\n                  Preset Days\r\n                </label>\r\n                <select\r\n                  value={totalDays}\r\n                  onChange={(e) => setTotalDays(e.target.value)}\r\n                  disabled={useCustomTotal || useExitDate}\r\n                  className=\"mt-1 block w-full border rounded p-2\"\r\n                >\r\n                  <option value={15}>15 Days</option>\r\n                  <option value={21}>21 Days</option>\r\n                  <option value={28}>28 Days</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Custom Days */}\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700\">\r\n                  Custom Total Days\r\n                </label>\r\n                <div className=\"flex items-center mt-1 gap-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={useCustomTotal}\r\n                    onChange={(e) => {\r\n                      setUseCustomTotal(e.target.checked);\r\n                      if (e.target.checked) setUseExitDate(false);\r\n                    }}\r\n                  />\r\n                  <input\r\n                    type=\"number\"\r\n                    min={1}\r\n                    value={customTotal}\r\n                    onChange={(e) => setCustomTotal(e.target.value)}\r\n                    disabled={!useCustomTotal}\r\n                    className=\"border rounded p-2 w-full\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Exit Date */}\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700\">\r\n                  Set Exit Date\r\n                </label>\r\n                <div className=\"flex items-center mt-1 gap-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={useExitDate}\r\n                    onChange={(e) => {\r\n                      setUseExitDate(e.target.checked);\r\n                      if (e.target.checked) setUseCustomTotal(false);\r\n                    }}\r\n                  />\r\n                  <input\r\n                    type=\"date\"\r\n                    value={displayExit || exitDateInput}\r\n                    onChange={(e) => {\r\n                      setExitDateInput(e.target.value);\r\n                      onExitChange(e.target.value);\r\n                    }}\r\n                    disabled={!useExitDate}\r\n                    className=\"border rounded p-2 w-full\"\r\n                  />\r\n                </div>\r\n\r\n                {excludeExit &&\r\n                  displayExit &&\r\n                  originalExitDate &&\r\n                  displayExit !== originalExitDate && (\r\n                    <div className=\"mt-1 text-sm bg-gradient-to-r from-red-500 via-red-600 to-rose-600 text-white p-2 rounded\">\r\n                      Note: The original departure date was{\" \"}\r\n                      <strong>{originalExitDate || displayExit}</strong> â€” the\r\n                      last night was counted; Counted last night:{\" \"}\r\n                      <strong>{displayExit}</strong>\r\n                    </div>\r\n                  )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Cities */}\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700\">\r\n                  Start City\r\n                </label>\r\n                <select\r\n                  value={startCity}\r\n                  onChange={(e) => setStartCity(e.target.value)}\r\n                  className=\"mt-1 block w-full border rounded p-2\"\r\n                >\r\n                  <option value=\"makkah\">Makkah</option>\r\n                  <option value=\"madinah\">Madinah</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700\">\r\n                  Exit City\r\n                </label>\r\n                <select\r\n                  value={exitCity}\r\n                  onChange={(e) => setExitCity(e.target.value)}\r\n                  className=\"mt-1 block w-full border rounded p-2\"\r\n                >\r\n                  <option value=\"makkah\">Makkah</option>\r\n                  <option value=\"madinah\">Madinah</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700\">\r\n                  Max MED Nights\r\n                </label>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={maxMadinah}\r\n                  onChange={(e) => setMaxMadinah(e.target.checked)}\r\n                  className=\"mt-2\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* NEW UI: exclude arrival/exit and weekend */}\r\n            <div\r\n              className=\"\r\n    flex flex-col\r\n    sm:flex-row\r\n    sm:items-center\r\n    gap-2 sm:gap-6\r\n    text-sm\r\n  \"\r\n            >\r\n              <label className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={excludeArrival}\r\n                  onChange={(e) => setExcludeArrival(e.target.checked)}\r\n                />\r\n                Exclude arrival night\r\n              </label>\r\n\r\n              <label className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={excludeExit}\r\n                  onChange={(e) => setExcludeExit(e.target.checked)}\r\n                />\r\n                Exclude Exit night\r\n              </label>\r\n\r\n              <label className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={markWeekend}\r\n                  onChange={(e) => setMarkWeekend(e.target.checked)}\r\n                />\r\n                Mark weekend nights\r\n              </label>\r\n            </div>\r\n\r\n            {/* Theme */}\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700\">\r\n                Theme Color\r\n              </label>\r\n              <div className=\"flex items-center gap-2 mt-2\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setTheme(\"bg-teal-600\")}\r\n                  className=\"w-8 h-8 rounded bg-teal-600 border-2\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setTheme(\"bg-indigo-600\")}\r\n                  className=\"w-8 h-8 rounded bg-indigo-600 border-2\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setTheme(\"bg-rose-500\")}\r\n                  className=\"w-8 h-8 rounded bg-rose-500 border-2\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setTheme(\"bg-amber-500\")}\r\n                  className=\"w-8 h-8 rounded bg-amber-500 border-2\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Buttons */}\r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                type=\"submit\"\r\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded\"\r\n              >\r\n                Generate Itinerary\r\n              </button>\r\n\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  setResult(null);\r\n                  setAdjustedResult(null);\r\n                  setNote(\"\");\r\n                  setUseCustomTotal(false);\r\n                  setUseExitDate(false);\r\n                  setOriginalDeparture(localToday);\r\n                  setDisplayDeparture(localToday);\r\n                  setOriginalExitDate(\"\");\r\n                  setDisplayExit(\"\");\r\n                  setExitDateInput(\"\");\r\n                  setExcludeArrival(false);\r\n                  setExcludeExit(false);\r\n                  setMarkWeekend(false);\r\n                }}\r\n                className=\"px-4 py-2 border rounded\"\r\n              >\r\n                Reset\r\n              </button>\r\n            </div>\r\n\r\n            {note && (\r\n              <div className=\"mt-2 text-sm bg-yellow-50 p-2 rounded text-gray-700\">\r\n                {note}\r\n              </div>\r\n            )}\r\n          </form>\r\n        </div>\r\n        {manualStays && (\r\n          <div className=\"mb-4 bg-white rounded shadow p-4\">\r\n            <h3 className=\"text-sm font-semibold mb-3\">\r\n              Manual Days Adjustment\r\n            </h3>\r\n\r\n            {manualStays.map((s, i) => (\r\n              <div\r\n                key={i}\r\n                className=\"flex items-center justify-between border-b py-2\"\r\n              >\r\n                <div className=\"capitalize flex items-center gap-2\">\r\n                  {s.city} stay {i + 1}\r\n                  {manualStays.length === 3 && (\r\n                    <label className=\"text-xs flex items-center gap-1\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={s.locked}\r\n                        onChange={() => {\r\n                          setManualStays((prev) =>\r\n                            prev.map((x, idx) =>\r\n                              idx === i ? { ...x, locked: !x.locked } : x\r\n                            )\r\n                          );\r\n                        }}\r\n                      />\r\n                      Lock\r\n                    </label>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                  <button\r\n                    onClick={() => onManualAdjust(i, -1)}\r\n                    className=\"px-2 py-1 border rounded\"\r\n                  >\r\n                    âˆ’\r\n                  </button>\r\n                  <span className=\"w-6 text-center\">{s.displayDays}</span>\r\n                  <button\r\n                    onClick={() => onManualAdjust(i, +1)}\r\n                    className=\"px-2 py-1 border rounded\"\r\n                  >\r\n                    +\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n\r\n            {manualFridayWarning && (\r\n              <div className=\"mt-3 p-2 text-sm rounded bg-red-100 text-red-700\">\r\n                âš ï¸ Manual adjustment ki wajah se travel day Friday ban raha hai.\r\n                Barah-e-karam aik din kam ya zyada karein.\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Results */}\r\n        <div className=\"mt-6\">\r\n          {result ? (\r\n            <>\r\n              <div className=\"mb-4\">\r\n                <TripSummaryCard\r\n                  data={adjustedResult || result}\r\n                  raw={result}\r\n                  excludeArrival={excludeArrival}\r\n                  excludeExit={excludeExit}\r\n                  markWeekend={markWeekend}\r\n                  themeClass={theme}\r\n                  onAccept={() => onAccept()}\r\n                />\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <div className=\"max-w-4xl mx-auto p-6 text-center text-gray-600\">\r\n              Generate a plan to see results here.\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}