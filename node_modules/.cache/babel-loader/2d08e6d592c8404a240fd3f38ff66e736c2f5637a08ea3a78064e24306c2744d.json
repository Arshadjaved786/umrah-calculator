{"ast":null,"code":"// src/utils/manualAdjuster.js\n// Manual adjustment helper for TripPlanner\n// Purpose:\n// - Adjust days (+ / -) for a specific stay\n// - Keep TOTAL DAYS FIXED (never allow overflow)\n// - Respect LOCKED stays (only when 3 stays)\n// - Recalculate dates chain (check-in / check-out)\n// - Detect Friday travel (WARNING only, no auto-fix)\n// - Emit WARNING when balance is NOT possible\n\nfunction parseIsoToDate(iso) {\n  if (!iso) return null;\n  const [y, m, d] = iso.split(\"-\").map(Number);\n  return new Date(y, m - 1, d);\n}\nfunction formatDate(d) {\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\nfunction addDays(date, n) {\n  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  d.setDate(d.getDate() + n);\n  return d;\n}\nfunction isFriday(date) {\n  return date.getDay() === 5;\n}\n\n/**\r\n * adjustStaysManually\r\n *\r\n * @param {Array} stays\r\n *   Each stay must have:\r\n *   - city\r\n *   - displayDays\r\n *   - isoCheckIn\r\n *   - locked (boolean)\r\n *\r\n * @param {number} targetIndex\r\n * @param {number} delta (+1 / -1)\r\n *\r\n * @returns {Object}\r\n * {\r\n *   stays,\r\n *   fridayWarning,\r\n *   balanceWarning\r\n * }\r\n */\nexport function adjustStaysManually(stays, targetIndex, delta) {\n  if (!Array.isArray(stays)) {\n    return {\n      stays,\n      fridayWarning: false,\n      balanceWarning: false\n    };\n  }\n\n  // Deep copy\n  const updated = stays.map(s => ({\n    ...s\n  }));\n  const target = updated[targetIndex];\n  if (!target) {\n    return {\n      stays: updated,\n      fridayWarning: false,\n      balanceWarning: false\n    };\n  }\n  const useLock = updated.length === 3;\n\n  // Locked target cannot be changed\n  if (useLock && target.locked) {\n    return {\n      stays: updated,\n      fridayWarning: false,\n      balanceWarning: true\n    };\n  }\n\n  // Minimum 1 day rule\n  if (target.displayDays + delta < 1) {\n    return {\n      stays: updated,\n      fridayWarning: false,\n      balanceWarning: true\n    };\n  }\n\n  // ------------------------------------\n  // BALANCE CHECK (BEFORE APPLYING DELTA)\n  // ------------------------------------\n  let balanceIndex = -1;\n  if (delta > 0) {\n    // Need some other stay to GIVE 1 day\n    let maxDays = 0;\n    updated.forEach((s, i) => {\n      if (i === targetIndex) return;\n      if (useLock && s.locked) return;\n      if (s.displayDays > 1 && s.displayDays > maxDays) {\n        maxDays = s.displayDays;\n        balanceIndex = i;\n      }\n    });\n\n    // ❌ No stay available to reduce → BLOCK\n    if (balanceIndex === -1) {\n      return {\n        stays: updated,\n        fridayWarning: false,\n        balanceWarning: true\n      };\n    }\n  }\n  if (delta < 0) {\n    // Need some other stay to RECEIVE 1 day\n    let minDays = Infinity;\n    updated.forEach((s, i) => {\n      if (i === targetIndex) return;\n      if (useLock && s.locked) return;\n      if (s.displayDays < minDays) {\n        minDays = s.displayDays;\n        balanceIndex = i;\n      }\n    });\n\n    // ❌ No stay available to add → BLOCK\n    if (balanceIndex === -1) {\n      return {\n        stays: updated,\n        fridayWarning: false,\n        balanceWarning: true\n      };\n    }\n  }\n\n  // ------------------------------------\n  // APPLY DELTA (SAFE NOW)\n  // ------------------------------------\n  target.displayDays += delta;\n  if (delta > 0 && balanceIndex !== -1) {\n    updated[balanceIndex].displayDays -= 1;\n  }\n  if (delta < 0 && balanceIndex !== -1) {\n    updated[balanceIndex].displayDays += 1;\n  }\n\n  // ------------------------------------\n  // REBUILD DATE CHAIN\n  // ------------------------------------\n  let fridayWarning = false;\n  let cursor = parseIsoToDate(updated[0].isoCheckIn);\n  updated.forEach((s, i) => {\n    s.isoCheckIn = formatDate(cursor);\n    const lastNight = addDays(cursor, s.displayDays - 1);\n    const checkOut = addDays(lastNight, 1);\n    if (i < updated.length - 1 && isFriday(checkOut)) {\n      fridayWarning = true;\n    }\n    s.isoLastNight = formatDate(lastNight);\n    s.isoCheckOutDay = formatDate(checkOut);\n    cursor = checkOut;\n  });\n  return {\n    stays: updated,\n    fridayWarning,\n    balanceWarning: false\n  };\n}","map":{"version":3,"names":["parseIsoToDate","iso","y","m","d","split","map","Number","Date","formatDate","yyyy","getFullYear","mm","String","getMonth","padStart","dd","getDate","addDays","date","n","setDate","isFriday","getDay","adjustStaysManually","stays","targetIndex","delta","Array","isArray","fridayWarning","balanceWarning","updated","s","target","useLock","length","locked","displayDays","balanceIndex","maxDays","forEach","i","minDays","Infinity","cursor","isoCheckIn","lastNight","checkOut","isoLastNight","isoCheckOutDay"],"sources":["C:/Users/Taj Tech/Downloads/umrah-calculator/src/utils/manualAdjuster.js"],"sourcesContent":["// src/utils/manualAdjuster.js\r\n// Manual adjustment helper for TripPlanner\r\n// Purpose:\r\n// - Adjust days (+ / -) for a specific stay\r\n// - Keep TOTAL DAYS FIXED (never allow overflow)\r\n// - Respect LOCKED stays (only when 3 stays)\r\n// - Recalculate dates chain (check-in / check-out)\r\n// - Detect Friday travel (WARNING only, no auto-fix)\r\n// - Emit WARNING when balance is NOT possible\r\n\r\nfunction parseIsoToDate(iso) {\r\n  if (!iso) return null;\r\n  const [y, m, d] = iso.split(\"-\").map(Number);\r\n  return new Date(y, m - 1, d);\r\n}\r\n\r\nfunction formatDate(d) {\r\n  const yyyy = d.getFullYear();\r\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const dd = String(d.getDate()).padStart(2, \"0\");\r\n  return `${yyyy}-${mm}-${dd}`;\r\n}\r\n\r\nfunction addDays(date, n) {\r\n  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n  d.setDate(d.getDate() + n);\r\n  return d;\r\n}\r\n\r\nfunction isFriday(date) {\r\n  return date.getDay() === 5;\r\n}\r\n\r\n/**\r\n * adjustStaysManually\r\n *\r\n * @param {Array} stays\r\n *   Each stay must have:\r\n *   - city\r\n *   - displayDays\r\n *   - isoCheckIn\r\n *   - locked (boolean)\r\n *\r\n * @param {number} targetIndex\r\n * @param {number} delta (+1 / -1)\r\n *\r\n * @returns {Object}\r\n * {\r\n *   stays,\r\n *   fridayWarning,\r\n *   balanceWarning\r\n * }\r\n */\r\nexport function adjustStaysManually(stays, targetIndex, delta) {\r\n  if (!Array.isArray(stays)) {\r\n    return { stays, fridayWarning: false, balanceWarning: false };\r\n  }\r\n\r\n  // Deep copy\r\n  const updated = stays.map((s) => ({ ...s }));\r\n\r\n  const target = updated[targetIndex];\r\n  if (!target) {\r\n    return { stays: updated, fridayWarning: false, balanceWarning: false };\r\n  }\r\n\r\n  const useLock = updated.length === 3;\r\n\r\n  // Locked target cannot be changed\r\n  if (useLock && target.locked) {\r\n    return { stays: updated, fridayWarning: false, balanceWarning: true };\r\n  }\r\n\r\n  // Minimum 1 day rule\r\n  if (target.displayDays + delta < 1) {\r\n    return { stays: updated, fridayWarning: false, balanceWarning: true };\r\n  }\r\n\r\n  // ------------------------------------\r\n  // BALANCE CHECK (BEFORE APPLYING DELTA)\r\n  // ------------------------------------\r\n  let balanceIndex = -1;\r\n\r\n  if (delta > 0) {\r\n    // Need some other stay to GIVE 1 day\r\n    let maxDays = 0;\r\n    updated.forEach((s, i) => {\r\n      if (i === targetIndex) return;\r\n      if (useLock && s.locked) return;\r\n      if (s.displayDays > 1 && s.displayDays > maxDays) {\r\n        maxDays = s.displayDays;\r\n        balanceIndex = i;\r\n      }\r\n    });\r\n\r\n    // ❌ No stay available to reduce → BLOCK\r\n    if (balanceIndex === -1) {\r\n      return {\r\n        stays: updated,\r\n        fridayWarning: false,\r\n        balanceWarning: true,\r\n      };\r\n    }\r\n  }\r\n\r\n  if (delta < 0) {\r\n    // Need some other stay to RECEIVE 1 day\r\n    let minDays = Infinity;\r\n    updated.forEach((s, i) => {\r\n      if (i === targetIndex) return;\r\n      if (useLock && s.locked) return;\r\n      if (s.displayDays < minDays) {\r\n        minDays = s.displayDays;\r\n        balanceIndex = i;\r\n      }\r\n    });\r\n\r\n    // ❌ No stay available to add → BLOCK\r\n    if (balanceIndex === -1) {\r\n      return {\r\n        stays: updated,\r\n        fridayWarning: false,\r\n        balanceWarning: true,\r\n      };\r\n    }\r\n  }\r\n\r\n  // ------------------------------------\r\n  // APPLY DELTA (SAFE NOW)\r\n  // ------------------------------------\r\n  target.displayDays += delta;\r\n\r\n  if (delta > 0 && balanceIndex !== -1) {\r\n    updated[balanceIndex].displayDays -= 1;\r\n  }\r\n\r\n  if (delta < 0 && balanceIndex !== -1) {\r\n    updated[balanceIndex].displayDays += 1;\r\n  }\r\n\r\n  // ------------------------------------\r\n  // REBUILD DATE CHAIN\r\n  // ------------------------------------\r\n  let fridayWarning = false;\r\n\r\n  let cursor = parseIsoToDate(updated[0].isoCheckIn);\r\n\r\n  updated.forEach((s, i) => {\r\n    s.isoCheckIn = formatDate(cursor);\r\n\r\n    const lastNight = addDays(cursor, s.displayDays - 1);\r\n    const checkOut = addDays(lastNight, 1);\r\n\r\n    if (i < updated.length - 1 && isFriday(checkOut)) {\r\n      fridayWarning = true;\r\n    }\r\n\r\n    s.isoLastNight = formatDate(lastNight);\r\n    s.isoCheckOutDay = formatDate(checkOut);\r\n\r\n    cursor = checkOut;\r\n  });\r\n\r\n  return {\r\n    stays: updated,\r\n    fridayWarning,\r\n    balanceWarning: false,\r\n  };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}