{"ast":null,"code":"// src/services/packageService.js\n// Ø³Ø§Ø¯Û package service: LocalStorage Ù…ÛŒÚº packages save / list / load / delete Ú©Ø±ØªØ§ ÛÛ’\n// Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û (Ù…Ø«Ù„Ø§Ù‹): import { savePackage, listPackages } from \"../services/packageService\";\n\nimport { v4 as uuidv4 } from \"uuid\";\n\n// LocalStorage key\nconst STORAGE_KEY = \"umrah_packages\";\n\n/**\r\n * helper: read packages array from localStorage (safe)\r\n */\nfunction _readAll() {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) return [];\n    const arr = JSON.parse(raw);\n    if (!Array.isArray(arr)) return [];\n    return arr;\n  } catch (err) {\n    console.error(\"packageService: read error\", err);\n    return [];\n  }\n}\n\n/**\r\n * helper: write packages array to localStorage\r\n */\nfunction _writeAll(arr) {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr || []));\n    return true;\n  } catch (err) {\n    console.error(\"packageService: write error\", err);\n    return false;\n  }\n}\n\n/**\r\n * Save a consolidated package snapshot.\r\n * - If pkg.id present -> update existing\r\n * - If no id -> create new id + createdAt\r\n * Returns saved package object (with id and createdAt) or null on failure.\r\n *\r\n * Expect pkg to be a plain object with fields:\r\n * { agency, itinerary, hotelsSelected, flights, visa, transport, pax, profit, totals, ... }\r\n */\nexport function savePackage(pkg) {\n  console.log(\"ðŸ”¥ savePackage CALLED\", pkg);\n  try {\n    const all = _readAll();\n    const now = new Date().toISOString();\n    let toSave = {\n      ...(pkg || {})\n    };\n    if (!toSave.id) {\n      toSave.id = `pkg_${uuidv4()}`;\n      toSave.createdAt = now;\n    } else if (!toSave.createdAt) {\n      toSave.createdAt = now;\n    }\n    toSave.updatedAt = now;\n\n    // minimal normalization: ensure totals object\n    if (!toSave.totals) toSave.totals = {};\n\n    // if itinerary not provided, try to grab umrah_last_plan from localStorage\n    if (!toSave.itinerary) {\n      try {\n        const last = localStorage.getItem(\"umrah_last_plan\");\n        if (last) toSave.itinerary = JSON.parse(last);\n      } catch (e) {\n        // ignore\n      }\n    }\n\n    // update existing if present\n    const idx = all.findIndex(x => x.id === toSave.id);\n    if (idx >= 0) {\n      all[idx] = toSave;\n    } else {\n      all.unshift(toSave); // newest first\n    }\n    const ok = _writeAll(all);\n    return ok ? toSave : null;\n  } catch (err) {\n    console.error(\"packageService.savePackage error\", err);\n    return null;\n  }\n}\n\n/**\r\n * List all saved packages (most recent first)\r\n */\nexport function listPackages() {\n  return _readAll();\n}\n\n/**\r\n * Load a single package by id (returns object or null)\r\n */\nexport function loadPackage(id) {\n  if (!id) return null;\n  const all = _readAll();\n  return all.find(p => p.id === id) || null;\n}\n\n/**\r\n * Delete package by id. Returns true if deleted, false otherwise.\r\n */\nexport function deletePackage(id) {\n  if (!id) return false;\n  const all = _readAll();\n  const next = all.filter(p => p.id !== id);\n  if (next.length === all.length) return false; // nothing removed\n  return _writeAll(next);\n}\n\n/**\r\n * Replace (overwrite) a package fully (must contain id).\r\n * Returns saved package or null.\r\n */\nexport function replacePackage(pkg) {\n  if (!pkg || !pkg.id) return null;\n  return savePackage(pkg);\n}\nexport default {\n  savePackage,\n  listPackages,\n  loadPackage,\n  deletePackage,\n  replacePackage\n};","map":{"version":3,"names":["v4","uuidv4","STORAGE_KEY","_readAll","raw","localStorage","getItem","arr","JSON","parse","Array","isArray","err","console","error","_writeAll","setItem","stringify","savePackage","pkg","log","all","now","Date","toISOString","toSave","id","createdAt","updatedAt","totals","itinerary","last","e","idx","findIndex","x","unshift","ok","listPackages","loadPackage","find","p","deletePackage","next","filter","length","replacePackage"],"sources":["C:/Users/Taj Tech/Downloads/umrah-calculator/src/services/packageService.js"],"sourcesContent":["// src/services/packageService.js\r\n// Ø³Ø§Ø¯Û package service: LocalStorage Ù…ÛŒÚº packages save / list / load / delete Ú©Ø±ØªØ§ ÛÛ’\r\n// Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û (Ù…Ø«Ù„Ø§Ù‹): import { savePackage, listPackages } from \"../services/packageService\";\r\n\r\nimport { v4 as uuidv4 } from \"uuid\";\r\n\r\n// LocalStorage key\r\nconst STORAGE_KEY = \"umrah_packages\";\r\n\r\n/**\r\n * helper: read packages array from localStorage (safe)\r\n */\r\nfunction _readAll() {\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (!raw) return [];\r\n    const arr = JSON.parse(raw);\r\n    if (!Array.isArray(arr)) return [];\r\n    return arr;\r\n  } catch (err) {\r\n    console.error(\"packageService: read error\", err);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * helper: write packages array to localStorage\r\n */\r\nfunction _writeAll(arr) {\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr || []));\r\n    return true;\r\n  } catch (err) {\r\n    console.error(\"packageService: write error\", err);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Save a consolidated package snapshot.\r\n * - If pkg.id present -> update existing\r\n * - If no id -> create new id + createdAt\r\n * Returns saved package object (with id and createdAt) or null on failure.\r\n *\r\n * Expect pkg to be a plain object with fields:\r\n * { agency, itinerary, hotelsSelected, flights, visa, transport, pax, profit, totals, ... }\r\n */\r\nexport function savePackage(pkg) {\r\n  console.log(\"ðŸ”¥ savePackage CALLED\", pkg);\r\n\r\n  try {\r\n    const all = _readAll();\r\n\r\n    const now = new Date().toISOString();\r\n    let toSave = { ...(pkg || {}) };\r\n\r\n    if (!toSave.id) {\r\n      toSave.id = `pkg_${uuidv4()}`;\r\n      toSave.createdAt = now;\r\n    } else if (!toSave.createdAt) {\r\n      toSave.createdAt = now;\r\n    }\r\n    toSave.updatedAt = now;\r\n\r\n    // minimal normalization: ensure totals object\r\n    if (!toSave.totals) toSave.totals = {};\r\n\r\n    // if itinerary not provided, try to grab umrah_last_plan from localStorage\r\n    if (!toSave.itinerary) {\r\n      try {\r\n        const last = localStorage.getItem(\"umrah_last_plan\");\r\n        if (last) toSave.itinerary = JSON.parse(last);\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    }\r\n\r\n    // update existing if present\r\n    const idx = all.findIndex((x) => x.id === toSave.id);\r\n    if (idx >= 0) {\r\n      all[idx] = toSave;\r\n    } else {\r\n      all.unshift(toSave); // newest first\r\n    }\r\n\r\n    const ok = _writeAll(all);\r\n    return ok ? toSave : null;\r\n  } catch (err) {\r\n    console.error(\"packageService.savePackage error\", err);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * List all saved packages (most recent first)\r\n */\r\nexport function listPackages() {\r\n  return _readAll();\r\n}\r\n\r\n/**\r\n * Load a single package by id (returns object or null)\r\n */\r\nexport function loadPackage(id) {\r\n  if (!id) return null;\r\n  const all = _readAll();\r\n  return all.find((p) => p.id === id) || null;\r\n}\r\n\r\n/**\r\n * Delete package by id. Returns true if deleted, false otherwise.\r\n */\r\nexport function deletePackage(id) {\r\n  if (!id) return false;\r\n  const all = _readAll();\r\n  const next = all.filter((p) => p.id !== id);\r\n  if (next.length === all.length) return false; // nothing removed\r\n  return _writeAll(next);\r\n}\r\n\r\n/**\r\n * Replace (overwrite) a package fully (must contain id).\r\n * Returns saved package or null.\r\n */\r\nexport function replacePackage(pkg) {\r\n  if (!pkg || !pkg.id) return null;\r\n  return savePackage(pkg);\r\n}\r\n\r\nexport default {\r\n  savePackage,\r\n  listPackages,\r\n  loadPackage,\r\n  deletePackage,\r\n  replacePackage,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}